#!/bin/bash -e

case "$1" in
    configure)
	templates_path="/etc/alternc/templates/"
	templates_source_apache="$templates_path/3.5/apache2/"
	alternc_version=$(dpkg-query --showformat='${Version}\n' --show alternc)
	if [[ -n "$alternc_version" ]]; then
        for template in "$templates_source_apache"/*.conf; do
            template_name=$(basename "$template")
            ln -sf "$template" "$templates_path/apache2/$template_name"
        done
	fi

    if ! a2query -m wsgi 2>&1 | grep -q enabled
    then 
	    a2enmod wsgi
	    service apache2 restart
    fi

	mysql --defaults-file=/etc/alternc/my.cnf -e "
    INSERT IGNORE INTO domaines_type SET name='wsgi', description='wsgi (python3)', target='DIRECTORY', entry='%SUB% IN A @@PUBLIC_IP@@', compatibility='txt,defmx,defmx2,mx,mx2', enable='ALL', need_dns=0, has_https_option=1, advanced=0, create_tmpdir=0, create_targetdir=1; "
	;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.
#DEBHELPER#
